{
  "code": "import PlayerDataMgr from \"./PlayerDataMgr\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class WxApi {\r\n    static LoginWx(cb) {\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        let launchData = Laya.Browser.window.wx.getLaunchOptionsSync();\r\n        Laya.Browser.window.wx.login({\r\n            success(res) {\r\n                if (res.code) {\r\n                    console.log('res.code:', res.code);\r\n                    if (cb) {\r\n                        cb(res.code, launchData.query);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    static checkScope(btnNode) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.getSetting({\r\n                success: (response) => {\r\n                    if (!response.authSetting['scope.userInfo']) {\r\n                        console.log('没有授权');\r\n                        this.createScope(btnNode);\r\n                    }\r\n                    else {\r\n                        console.log('已经授权');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    static createScope(btnNode) {\r\n        this.scopeBtn = Laya.Browser.window.wx.createUserInfoButton({\r\n            type: 'text',\r\n            text: '',\r\n            style: {\r\n                left: btnNode.x,\r\n                top: btnNode.y,\r\n                width: btnNode.width,\r\n                height: btnNode.height,\r\n                lineHeight: 40,\r\n                backgroundColor: '#ffffff',\r\n                color: '#ffffff',\r\n                textAlign: 'center',\r\n                fontSize: 16,\r\n                borderRadius: 0\r\n            }\r\n        });\r\n        this.scopeBtn.onTap((res) => {\r\n            if (res.errMsg == \"getUserInfo:ok\") {\r\n                this.scopeBtn.destroy();\r\n                this.scopeBtn = null;\r\n            }\r\n            else if (res.errMsg == 'getUserInfo:fail auth deny') {\r\n                this.scopeBtn.destroy();\r\n                this.scopeBtn = null;\r\n            }\r\n        });\r\n    }\r\n    static GetLaunchParam(fun) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            this.OnShowFun = fun;\r\n            fun(this.GetLaunchPassVar());\r\n            Laya.Browser.window.wx.onShow((para) => {\r\n                if (this.OnShowFun != null) {\r\n                    this.OnShowFun(para);\r\n                }\r\n                console.log(\"wx on show\");\r\n            });\r\n        }\r\n    }\r\n    static GetLaunchPassVar() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            return Laya.Browser.window.wx.getLaunchOptionsSync();\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    static WxOnHide(fun) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.onHide(fun);\r\n        }\r\n    }\r\n    static WxOffHide(fun) {\r\n        if (fun && Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.offHide(fun);\r\n        }\r\n    }\r\n    static httpRequest(url, params, type = 'get', completeHandler) {\r\n        var xhr = new Laya.HttpRequest();\r\n        xhr.http.timeout = 5000;\r\n        xhr.once(Laya.Event.COMPLETE, this, completeHandler);\r\n        xhr.once(Laya.Event.ERROR, this, this.httpRequest, [url, params, type, completeHandler]);\r\n        if (type == \"get\") {\r\n            xhr.send(url + '?' + params, \"\", type, \"text\");\r\n        }\r\n        else if (type == \"post\") {\r\n            xhr.send(url, JSON.stringify(params), type, \"text\");\r\n        }\r\n    }\r\n    static DoVibrate(isShort = true) {\r\n        if (Laya.Browser.onWeiXin && this.isVibrate) {\r\n            if (isShort) {\r\n                Laya.Browser.window.wx.vibrateShort();\r\n            }\r\n            else {\r\n                Laya.Browser.window.wx.vibrateLong();\r\n            }\r\n        }\r\n    }\r\n    static OpenAlert(msg, dur = 2000, icon = false) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.showToast({\r\n                title: msg,\r\n                duration: dur,\r\n                mask: false,\r\n                icon: icon ? 'success' : 'none',\r\n            });\r\n        }\r\n    }\r\n    static NavigateApp(appid, path, title, cancelCB, successCB) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            let self = this;\r\n            Laya.Browser.window.wx.navigateToMiniProgram({\r\n                appId: appid,\r\n                path: path,\r\n                success(res) {\r\n                    console.log('打开成功');\r\n                    successCB();\r\n                },\r\n                fail(res) {\r\n                    console.log('打开失败');\r\n                    cancelCB();\r\n                }\r\n            });\r\n        }\r\n    }\r\n    static preViewImage(url) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.previewImage({\r\n                current: url,\r\n                urls: [url]\r\n            });\r\n        }\r\n    }\r\n    static aldEvent(str) {\r\n        if (Laya.Browser.onWeiXin)\r\n            Laya.Browser.window.wx.aldSendEvent(str);\r\n    }\r\n    static fixBtnTouchPos(btn, startPosY, endPosY, target, cb, useEnd) {\r\n        if (this.isValidBanner()) {\r\n            btn.y = startPosY;\r\n            Laya.timer.once(JJMgr.instance.dataConfig.front_banner_showtime, target, () => { AdMgr.instance.showBanner(); });\r\n            Laya.timer.once(JJMgr.instance.dataConfig.front_banner_showtime + JJMgr.instance.dataConfig.front_button_moveup, target, () => {\r\n                Utility.tMove2D(btn, btn.x, endPosY, 1000);\r\n                cb && cb();\r\n            });\r\n        }\r\n        else {\r\n            btn.y = useEnd ? endPosY : startPosY;\r\n            if (useEnd)\r\n                AdMgr.instance.showBanner();\r\n            cb && cb();\r\n        }\r\n    }\r\n    static isValidBanner() {\r\n        return PlayerDataMgr.getPlayerData().grade >= JJMgr.instance.dataConfig.front_pass_gate && JJMgr.instance.dataConfig.is_allow_area == 1\r\n            && this.allowScene();\r\n    }\r\n    static allowScene() {\r\n        let s = JJMgr.instance.dataConfig.front_wuchu_scene.toString();\r\n        if (s.search('|') == -1) {\r\n            let sInt = parseInt(s);\r\n            return sInt == WxApi.sceneId;\r\n        }\r\n        let sArr = s.split('|');\r\n        for (let i = 0; i < sArr.length; i++) {\r\n            let sInt = parseInt(sArr[i]);\r\n            if (sInt == WxApi.sceneId) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    static bannerWuChu2() {\r\n        clearTimeout(this.bannerTO2);\r\n        AdMgr.instance.hideBanner();\r\n        if (WxApi.isValidBanner()) {\r\n            let upTime = JJMgr.instance.dataConfig.front_export_banner_appear;\r\n            let downTime = upTime + JJMgr.instance.dataConfig.front_export_banner_hide;\r\n            this.bannerTO2 = setTimeout(() => {\r\n                AdMgr.instance.showBanner();\r\n                this.bannerTO2 = setTimeout(() => {\r\n                    AdMgr.instance.hideBanner();\r\n                }, downTime);\r\n            }, upTime);\r\n        }\r\n        else {\r\n            AdMgr.instance.hideBanner();\r\n        }\r\n    }\r\n    static bannerWuChu1() {\r\n        clearTimeout(this.bannerTO1);\r\n        AdMgr.instance.hideBanner();\r\n        if (WxApi.isValidBanner()) {\r\n            let upTime = JJMgr.instance.dataConfig.front_baokuan_banner_appear;\r\n            let downTime = upTime + JJMgr.instance.dataConfig.front_baokuan_banner_hide;\r\n            this.bannerTO1 = setTimeout(() => {\r\n                AdMgr.instance.showBanner();\r\n                this.bannerTO1 = setTimeout(() => {\r\n                    AdMgr.instance.hideBanner();\r\n                }, downTime);\r\n            }, upTime);\r\n        }\r\n        else {\r\n            AdMgr.instance.hideBanner();\r\n        }\r\n    }\r\n    static splitSection() {\r\n        let s = JJMgr.instance.dataConfig.front_water_section.toString();\r\n        if (s.search('|') == -1) {\r\n            let sInt = parseInt(s);\r\n            return [sInt];\r\n        }\r\n        let sArr = s.split('|');\r\n        let iArr = [];\r\n        for (let i = 0; i < sArr.length; i++) {\r\n            let sInt = parseInt(sArr[i]);\r\n            iArr.push(sInt);\r\n        }\r\n        return iArr;\r\n    }\r\n    static getIsExportValid() {\r\n        return JJMgr.instance.dataConfig.front_all_export_switch;\r\n    }\r\n    static calculateShareNumber() {\r\n        if (localStorage.getItem('lastDate')) {\r\n            if (new Date().getDate() == parseInt(localStorage.getItem('lastDate'))) {\r\n                this.front_share_number = parseInt(localStorage.getItem('front_share_number'));\r\n            }\r\n            else {\r\n                this.front_share_number = JJMgr.instance.dataConfig.front_banner_number;\r\n            }\r\n        }\r\n        else {\r\n            this.front_share_number = JJMgr.instance.dataConfig.front_banner_number;\r\n        }\r\n        console.log('this.front_share_number:', this.front_share_number);\r\n    }\r\n}\r\nWxApi.UnityPath = 'LayaScene_SampleScene/Conventional/';\r\nWxApi.openId = '';\r\nWxApi.version = '1.0.1';\r\nWxApi.isVibrate = true;\r\nWxApi.isMusic = true;\r\nWxApi.OnShowFun = null;\r\nWxApi.scopeBtn = null;\r\nWxApi.shareCallback = null;\r\nWxApi.front_share_number = 0;\r\nWxApi.sceneId = 0;\r\nWxApi.gotOfflineBounes = false;\r\nWxApi.configData = null;\r\nWxApi.shareTime = 0;\r\nWxApi.firstShare = true;\r\nWxApi.hadShowFriendUI = false;\r\nWxApi.launchGameUI = false;\r\nWxApi.firstStartGame = false;\r\nWxApi.isKillBossUI = false;\r\nWxApi.fromKillBossUI = false;\r\nWxApi.killbossCallback = null;\r\nWxApi.tempGrade = 1;\r\nWxApi.bannerTO2 = -1;\r\nWxApi.bannerTO1 = -1;\r\n",
  "references": [
    "E:/LayaProjects/PoleRush/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/PoleRush/src/Mod/AdMgr.ts",
    "E:/LayaProjects/PoleRush/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/PoleRush/src/Mod/Utility.ts"
  ]
}
