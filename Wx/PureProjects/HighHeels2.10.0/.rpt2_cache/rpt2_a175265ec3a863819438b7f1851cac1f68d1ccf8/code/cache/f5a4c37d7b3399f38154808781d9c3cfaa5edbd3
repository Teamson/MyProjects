{
  "code": "import JJMgr, { SceneDir } from \"../JJExport/Common/JJMgr\";\r\nimport PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport ShareMgr from \"../Mod/ShareMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class BoxUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.skinId = -1;\r\n        this.keyCount = 3;\r\n        this.openCount = 0;\r\n        this.gotSkin = false;\r\n        this.randomArr = [20, 15, 10, 10, 10, 10, 10, 10, 5];\r\n        this.boxArr = [15, 25, 35, 45, 55, 65, 75, 85, 100];\r\n    }\r\n    onOpened() {\r\n        this.skinId = PlayerDataMgr.getUnlockShoesId();\r\n        if (this.skinId != -1) {\r\n            this.bestPic.skin = 'skinUI/shoes/Shoes' + (this.skinId + 1) + '.png';\r\n        }\r\n        this.keyCount = 3;\r\n        Laya.timer.frameLoop(1, this, this.updateCB);\r\n        Utility.addClickEvent(this.getBtn, this, this.getKeyBtnCB);\r\n        Utility.addClickEvent(this.backBtn, this, this.backBtnCB);\r\n        this.getBtn.visible = false;\r\n        this.backBtn.visible = false;\r\n        this.initItem();\r\n    }\r\n    onClosed() {\r\n    }\r\n    initItem() {\r\n        for (let i = 0; i < this.itemNode.numChildren; i++) {\r\n            let item = this.itemNode.getChildAt(i);\r\n            let box = item.getChildByName('box');\r\n            let coin = item.getChildByName('diamond');\r\n            let num = item.getChildByName('num');\r\n            coin.visible = false;\r\n            num.visible = false;\r\n            item.on(Laya.Event.CLICK, this, this.itemCB, [i]);\r\n        }\r\n    }\r\n    itemCB(id) {\r\n        if (this.openCount >= 9 || this.keyCount <= 0 || !this.itemNode.getChildAt(id).getChildByName('box').visible)\r\n            return;\r\n        this.keyCount--;\r\n        let randV = Math.random() * 100;\r\n        let v = 0;\r\n        let index = 0;\r\n        for (let i = 0; i < this.randomArr.length; i++) {\r\n            if (randV <= this.randomArr[i] + v) {\r\n                index = i;\r\n                break;\r\n            }\r\n            v += this.randomArr[i];\r\n        }\r\n        let num = this.randomArr.splice(index, 1)[0];\r\n        this.randomArr.forEach(r => {\r\n            r += num / this.randomArr.length;\r\n        });\r\n        let bounes = this.boxArr[index];\r\n        this.boxArr.splice(index, 1);\r\n        this.openCount++;\r\n        if (this.openCount % 3 == 0) {\r\n            if (this.openCount < 9)\r\n                this.getBtn.visible = true;\r\n            this.backBtn.visible = true;\r\n        }\r\n        let item = this.itemNode.getChildAt(id);\r\n        item.skin = 'boxUI/mh_dk_04.png';\r\n        let box = item.getChildByName('box');\r\n        let coin = item.getChildByName('diamond');\r\n        let coinV = item.getChildByName('num');\r\n        box.visible = false;\r\n        coin.visible = true;\r\n        coinV.visible = true;\r\n        if (bounes == 100 && this.skinId != -1 && !this.gotSkin) {\r\n            this.gotSkin = true;\r\n            coin.visible = false;\r\n            coinV.visible = false;\r\n            box.visible = true;\r\n            box.skin = 'skinUI/shoes/Shoes' + (this.skinId + 1) + '.png';\r\n            PlayerDataMgr.getPlayerData().shoesArr[this.skinId] = 1;\r\n            PlayerDataMgr.getPlayerData().shoesId = this.skinId;\r\n            PlayerDataMgr.setPlayerData();\r\n        }\r\n        else {\r\n            PlayerDataMgr.changeCoin(bounes);\r\n            coinV.value = bounes.toString();\r\n        }\r\n    }\r\n    getKeyBtnCB() {\r\n        let cb = () => {\r\n            this.keyCount = 3;\r\n            this.getBtn.visible = false;\r\n            this.backBtn.visible = false;\r\n        };\r\n        ShareMgr.instance.shareGame(cb);\r\n    }\r\n    backBtnCB() {\r\n        AdMgr.instance.hideBanner();\r\n        Laya.Scene.closeAll();\r\n        JJMgr.instance.openScene(SceneDir.SCENE_FULLGAMEUI, true, {\r\n            continueCallbackFun: () => {\r\n                JJMgr.instance.openScene(SceneDir.SCENE_RECOMMENDUI, false, {\r\n                    closeCallbackFun: () => {\r\n                        JJMgr.instance.openScene(SceneDir.SCENE_FRIENDGAME, false, {\r\n                            closeCallbackFun: () => {\r\n                                PlayerDataMgr.getPlayerData().key = 0;\r\n                                PlayerDataMgr.setPlayerData();\r\n                                Laya.Scene.open('MyScenes/FinishUI.scene', false);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n    updateCB() {\r\n        for (let i = 0; i < this.keyNode.numChildren; i++) {\r\n            let key = this.keyNode.getChildAt(i);\r\n            key.skin = i < this.keyCount ? 'boxUI/mh_ys_01.png' : 'boxUI/mh_ys_02.png';\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=BoxUI.js.map",
  "references": [
    "E:/LayaProjects/HighHeels2.10.0/src/Crl/GameLogic.ts",
    "E:/LayaProjects/HighHeels2.10.0/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/HighHeels2.10.0/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/HighHeels2.10.0/src/Mod/AdMgr.ts",
    "E:/LayaProjects/HighHeels2.10.0/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/HighHeels2.10.0/src/Mod/Utility.ts"
  ],
  "map": "{\"version\":3,\"file\":\"BoxUI.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/View/BoxUI.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
