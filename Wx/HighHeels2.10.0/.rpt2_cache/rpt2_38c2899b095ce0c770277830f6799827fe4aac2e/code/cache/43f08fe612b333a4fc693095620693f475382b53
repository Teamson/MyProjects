{
  "code": "import GameLogic from \"../Crl/GameLogic\";\r\nimport MoveComponent from \"../Crl/MoveComponent\";\r\nimport Player, { AniState } from \"../Crl/Player\";\r\nimport FdAd from \"../FanDong/FdAd\";\r\nimport PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class SkinUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.curPage = -1;\r\n        this.scene3D = null;\r\n        this.light = null;\r\n        this.camera = null;\r\n        this._player = null;\r\n        this._playerCrl = null;\r\n        this._playerMan = null;\r\n        this._playerManCrl = null;\r\n    }\r\n    onOpened() {\r\n        Laya.timer.frameLoop(1, this, this.updateCB);\r\n        Utility.addClickEvent(this.closeBtn, this, this.closeBtnCB);\r\n        this.btn1.on(Laya.Event.CLICK, this, this.pageBtnCB, [0]);\r\n        this.btn2.on(Laya.Event.CLICK, this, this.pageBtnCB, [1]);\r\n        this.btn3.on(Laya.Event.CLICK, this, this.pageBtnCB, [2]);\r\n        Utility.addClickEvent(this.randUnlockBtn, this, this.randUnlockBtnCB);\r\n        Utility.addClickEvent(this.adBtn, this, this.adBtnCB);\r\n        this.init3DScene();\r\n        this.initList();\r\n        this.pageBtnCB(0);\r\n    }\r\n    onClosed() {\r\n        Laya.timer.clearAll(this);\r\n        this.scene3D.destroy();\r\n        GameLogic.Share._player.getComponent(MoveComponent).stageOff();\r\n        GameLogic.Share._player.destroy();\r\n        GameLogic.Share.createPlayer();\r\n        GameLogic.Share._scene.active = true;\r\n        GameLogic.Share._camera.active = true;\r\n    }\r\n    init3DScene() {\r\n        this.scene3D = Laya.stage.addChild(new Laya.Scene3D());\r\n        this.scene3D.zOrder = 100;\r\n        this.light = this.scene3D.addChild(new Laya.DirectionLight());\r\n        this.light.color = new Laya.Vector3(1, 0.956, 0.839);\r\n        this.camera = this.scene3D.addChild(new Laya.Camera(0, 0.1, 1000));\r\n        this.camera.transform.translate(new Laya.Vector3(0, 1.5, 5));\r\n        this.camera.transform.rotate(new Laya.Vector3(-20, 0, 0), true, false);\r\n        this.camera.clearFlag = Laya.BaseCamera.CLEARFLAG_DEPTHONLY;\r\n        this.camera.fieldOfView = 60;\r\n        this.createPlayer(PlayerDataMgr.getPlayerData().skinId);\r\n        this.createPlayerMan(PlayerDataMgr.getPlayerData().skinId);\r\n        this.activePlayer(PlayerDataMgr.getPlayerData().skinId);\r\n    }\r\n    createPlayer(id) {\r\n        let isMan = id == 4 || id == 8 || id == 11 || id == 13 || id == 14;\r\n        let name = 'Wuman_01.lh';\r\n        this._player = Utility.getSprite3DResByUrl(name, this.scene3D);\r\n        this._playerCrl = this._player.addComponent(Player);\r\n        this._playerCrl.playAnimation(AniState.ANI_WALK);\r\n        this._player.transform.setWorldLossyScale(new Laya.Vector3(1, 1, 1));\r\n    }\r\n    createPlayerMan(id) {\r\n        let name = 'Man_01.lh';\r\n        this._playerMan = Utility.getSprite3DResByUrl(name, this.scene3D);\r\n        this._playerManCrl = this._playerMan.addComponent(Player);\r\n        this._playerManCrl.playAnimation(AniState.ANI_WALK);\r\n        this._playerMan.transform.setWorldLossyScale(new Laya.Vector3(1, 1, 1));\r\n    }\r\n    activePlayer(id) {\r\n        let isMan = id == 4 || id == 8 || id == 11 || id == 13 || id == 14;\r\n        this._playerMan.active = isMan;\r\n        this._player.active = !isMan;\r\n    }\r\n    fixCameraField() {\r\n        let staticDT = 1624 - 1334;\r\n        let curDT = Laya.stage.displayHeight - 1334 < 0 ? 0 : Laya.stage.displayHeight - 1334;\r\n        let per = curDT / staticDT * 5;\r\n        this.camera.fieldOfView += per;\r\n    }\r\n    pageBtnCB(id) {\r\n        if (this.curPage == id)\r\n            return;\r\n        this.curPage = id;\r\n        this.btn1.scale(1, 1);\r\n        this.btn2.scale(1, 1);\r\n        this.btn3.scale(1, 1);\r\n        switch (id) {\r\n            case 0:\r\n                this.btn1.scale(1.2, 1.2);\r\n                break;\r\n            case 1:\r\n                this.btn2.scale(1.2, 1.2);\r\n                break;\r\n            case 2:\r\n                this.btn3.scale(1.2, 1.2);\r\n                break;\r\n        }\r\n        this.refreshListData();\r\n    }\r\n    initList() {\r\n        this.myList.vScrollBarSkin = '';\r\n        if (this.curPage == 0) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().skinArr;\r\n        }\r\n        else if (this.curPage == 1) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().shoesArr;\r\n        }\r\n        else if (this.curPage == 2) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().hatArr;\r\n        }\r\n        this.myList.repeatX = 4;\r\n        this.myList.renderHandler = Laya.Handler.create(this, this.onListRender, null, false);\r\n    }\r\n    refreshListData() {\r\n        if (this.curPage == 0) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().skinArr;\r\n            this.maxPic.visible = PlayerDataMgr.getUnlockSkinId(true) == -1;\r\n            this.randUnlockBtn.visible = PlayerDataMgr.getUnlockSkinId(true) != -1;\r\n        }\r\n        else if (this.curPage == 1) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().shoesArr;\r\n            this.maxPic.visible = PlayerDataMgr.getUnlockShoesId(true) == -1;\r\n            this.randUnlockBtn.visible = PlayerDataMgr.getUnlockShoesId(true) != -1;\r\n        }\r\n        else if (this.curPage == 2) {\r\n            this.myList.array = PlayerDataMgr.getPlayerData().hatArr;\r\n            this.maxPic.visible = PlayerDataMgr.getUnlockHatId(true) == -1;\r\n            this.randUnlockBtn.visible = PlayerDataMgr.getUnlockHatId(true) != -1;\r\n        }\r\n    }\r\n    onListRender(cell, index) {\r\n        if (index >= this.myList.array.length) {\r\n            return;\r\n        }\r\n        var item = cell.getChildByName('item');\r\n        let icon = item.getChildByName('icon');\r\n        let bg = item.getChildByName('bg');\r\n        let num = bg.getChildByName('num');\r\n        let star = item.getChildByName('star');\r\n        star.visible = index >= 10;\r\n        if (this.curPage == 0) {\r\n            bg.visible = index >= 10 && PlayerDataMgr.getPlayerData().videoArr[index - 10] < 3;\r\n            if (bg.visible)\r\n                num.value = PlayerDataMgr.getPlayerData().videoArr[index - 10].toString();\r\n            item.skin = index == PlayerDataMgr.getPlayerData().skinId ? 'skinUI/sd_dk_02.png' : 'skinUI/sd_dk_01.png';\r\n            icon.skin = PlayerDataMgr.getPlayerData().skinArr[index] == 1 ? 'skinUI/role/Hero' + (index + 1) + '.png' : 'skinUI/sd_wh_01.png';\r\n        }\r\n        else if (this.curPage == 1) {\r\n            bg.visible = index >= 10 && PlayerDataMgr.getPlayerData().videoArr[index - 5] < 3;\r\n            if (bg.visible)\r\n                num.value = PlayerDataMgr.getPlayerData().videoArr[index - 5].toString();\r\n            item.skin = index == PlayerDataMgr.getPlayerData().shoesId ? 'skinUI/sd_dk_02.png' : 'skinUI/sd_dk_01.png';\r\n            icon.skin = PlayerDataMgr.getPlayerData().shoesArr[index] == 1 ? 'skinUI/shoes/Shoes' + (index + 1) + '.png' : 'skinUI/sd_wh_01.png';\r\n        }\r\n        else if (this.curPage == 2) {\r\n            bg.visible = index >= 10 && PlayerDataMgr.getPlayerData().videoArr[index] < 3;\r\n            if (bg.visible)\r\n                num.value = PlayerDataMgr.getPlayerData().videoArr[index].toString();\r\n            item.skin = index == PlayerDataMgr.getPlayerData().hatId ? 'skinUI/sd_dk_02.png' : 'skinUI/sd_dk_01.png';\r\n            icon.skin = PlayerDataMgr.getPlayerData().hatArr[index] == 1 ? 'skinUI/hat/Acc' + (index + 1) + '.png' : 'skinUI/sd_wh_01.png';\r\n        }\r\n        item.off(Laya.Event.CLICK, this, this.selectSkin);\r\n        item.on(Laya.Event.CLICK, this, this.selectSkin, [index]);\r\n    }\r\n    selectSkin(index) {\r\n        if (this.curPage == 0) {\r\n            if (index < 10 && PlayerDataMgr.getPlayerData().skinArr[index] == 0)\r\n                return;\r\n            if (index >= 10 && PlayerDataMgr.getPlayerData().skinArr[index] == 0) {\r\n                let cb = () => {\r\n                    PlayerDataMgr.getPlayerData().videoArr[index - 10]++;\r\n                    if (PlayerDataMgr.getPlayerData().videoArr[index - 10] >= 3)\r\n                        PlayerDataMgr.getPlayerData().skinArr[index] = 1;\r\n                    PlayerDataMgr.setPlayerData();\r\n                };\r\n                FdAd.showVideoAd(cb);\r\n            }\r\n            else {\r\n                PlayerDataMgr.getPlayerData().skinId = index;\r\n                PlayerDataMgr.setPlayerData();\r\n                this.activePlayer(index);\r\n                let isMan = index == 4 || index == 8 || index == 11 || index == 13 || index == 14;\r\n                if (isMan) {\r\n                    this._playerManCrl.changeSkin(index);\r\n                    this._playerManCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n                else {\r\n                    this._playerCrl.changeSkin(index);\r\n                    this._playerCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n            }\r\n        }\r\n        else if (this.curPage == 1) {\r\n            if (index < 10 && PlayerDataMgr.getPlayerData().shoesArr[index] == 0)\r\n                return;\r\n            if (index >= 10 && PlayerDataMgr.getPlayerData().shoesArr[index] == 0) {\r\n                let cb = () => {\r\n                    PlayerDataMgr.getPlayerData().videoArr[index - 5]++;\r\n                    if (PlayerDataMgr.getPlayerData().videoArr[index - 5] >= 3)\r\n                        PlayerDataMgr.getPlayerData().shoesArr[index] = 1;\r\n                    PlayerDataMgr.setPlayerData();\r\n                };\r\n                FdAd.showVideoAd(cb);\r\n            }\r\n            else {\r\n                PlayerDataMgr.getPlayerData().shoesId = index;\r\n                PlayerDataMgr.setPlayerData();\r\n                if (this._playerMan.active) {\r\n                    this._playerManCrl.initShoes(index);\r\n                    this._playerManCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n                else {\r\n                    this._playerCrl.initShoes(index);\r\n                    this._playerCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n            }\r\n        }\r\n        else if (this.curPage == 2) {\r\n            if (index < 10 && PlayerDataMgr.getPlayerData().hatArr[index] == 0)\r\n                return;\r\n            if (index >= 10 && PlayerDataMgr.getPlayerData().hatArr[index] == 0) {\r\n                let cb = () => {\r\n                    PlayerDataMgr.getPlayerData().videoArr[index]++;\r\n                    if (PlayerDataMgr.getPlayerData().videoArr[index] >= 3)\r\n                        PlayerDataMgr.getPlayerData().hatArr[index] = 1;\r\n                    PlayerDataMgr.setPlayerData();\r\n                    this.refreshListData();\r\n                };\r\n                FdAd.showVideoAd(cb);\r\n            }\r\n            else {\r\n                PlayerDataMgr.getPlayerData().hatId = index;\r\n                PlayerDataMgr.setPlayerData();\r\n                if (this._playerMan.active) {\r\n                    this._playerManCrl.activeAcc(index);\r\n                    this._playerManCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n                else {\r\n                    this._playerCrl.activeAcc(index);\r\n                    this._playerCrl.playAnimation(AniState.ANI_WALK);\r\n                }\r\n            }\r\n        }\r\n        this.refreshListData();\r\n    }\r\n    randUnlockBtnCB() {\r\n        if (PlayerDataMgr.getPlayerData().coin < 600) {\r\n            WxApi.OpenAlert('钻石不足！');\r\n            return;\r\n        }\r\n        if (this.curPage == 0) {\r\n            let id = PlayerDataMgr.getUnlockSkinId(true);\r\n            PlayerDataMgr.getPlayerData().skinArr[id] = 1;\r\n        }\r\n        else if (this.curPage == 1) {\r\n            let id = PlayerDataMgr.getUnlockShoesId(true);\r\n            PlayerDataMgr.getPlayerData().shoesArr[id] = 1;\r\n        }\r\n        else if (this.curPage == 2) {\r\n            let id = PlayerDataMgr.getUnlockHatId(true);\r\n            PlayerDataMgr.getPlayerData().hatArr[id] = 1;\r\n        }\r\n        PlayerDataMgr.changeCoin(-600);\r\n        this.refreshListData();\r\n    }\r\n    adBtnCB() {\r\n        let cb = () => {\r\n            PlayerDataMgr.changeCoin(600);\r\n        };\r\n        FdAd.showVideoAd(cb);\r\n    }\r\n    closeBtnCB() {\r\n        Laya.Scene.open('MyScenes/StartUI.scene');\r\n    }\r\n    updateCB() {\r\n    }\r\n}\r\n",
  "references": [
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Crl/GameLogic.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Crl/MoveComponent.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Crl/Player.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/FanDong/FdAd.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Libs/PlayerDataMgr.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Libs/WxApi.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Mod/Utility.ts"
  ]
}
