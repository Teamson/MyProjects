{
  "code": "import Utility from \"../Mod/Utility\";\r\nimport FdMgr from \"./FdMgr\";\r\nexport default class FdAd {\r\n    static inidAd() {\r\n        console.log('asdasdasdasd:', FdMgr);\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        this.initBanner();\r\n        this.createVideoAd();\r\n        this.initGridAD();\r\n    }\r\n    static getSystemInfoSync() {\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        if (!this.sysInfo) {\r\n            this.sysInfo = window['wx'].getSystemInfoSync();\r\n        }\r\n        return this.sysInfo;\r\n    }\r\n    static initBanner() {\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        this.bannerIdArr = Utility.shuffleArr(this.bannerIdArr);\r\n        console.log('bannerId 数组排列：', this.bannerIdArr);\r\n        if (!FdMgr.canTrapAll && this.bannerAds.length > 1) {\r\n            this.bannerAds.splice(0, this.bannerAds.length - 1);\r\n        }\r\n        for (let i = 0; i < this.bannerIdArr.length; i++) {\r\n            this.bannerTimesArr.push(0);\r\n            this.bannerShowCount.push(0);\r\n            this.bannerErrorArr.push(false);\r\n        }\r\n        for (let i = 0; i < this.bannerIdArr.length; i++) {\r\n            let bannerAd = this.createBannerAd(i);\r\n            this.bannerAds.push(bannerAd);\r\n        }\r\n    }\r\n    static get isAllBannerError() {\r\n        let isAllError = true;\r\n        for (let i = 0; i < this.bannerErrorArr.length; i++) {\r\n            if (!this.bannerErrorArr[i]) {\r\n                isAllError = false;\r\n                break;\r\n            }\r\n        }\r\n        return isAllError;\r\n    }\r\n    static showBannerAd() {\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        if (this.isAllBannerError) {\r\n            this.stopCountBannerTime();\r\n            return;\r\n        }\r\n        this.bannerAds[this.bannerIndex] && this.bannerAds[this.bannerIndex].show();\r\n        this.stopCountBannerTime();\r\n        if (!FdMgr.canTrapAll)\r\n            return;\r\n        Laya.timer.loop(100, this, this.countBannerTime);\r\n    }\r\n    static hideBannerAd() {\r\n        if (!Laya.Browser.onWeiXin || this.isAllBannerError) {\r\n            this.stopCountBannerTime();\r\n            return;\r\n        }\r\n        this.bannerAds[this.bannerIndex] && this.bannerAds[this.bannerIndex].hide();\r\n        this.stopCountBannerTime();\r\n    }\r\n    static countBannerTime() {\r\n        this.bannerTimesArr[this.bannerIndex] += 0.1;\r\n        if (this.bannerTimesArr[this.bannerIndex] >= FdMgr.jsonConfig.refresh_banner_time) {\r\n            this.bannerAds[this.bannerIndex] && this.bannerAds[this.bannerIndex].hide();\r\n            this.bannerTimesArr[this.bannerIndex] = 0;\r\n            this.bannerShowCount[this.bannerIndex]++;\r\n            if (this.bannerShowCount[this.bannerIndex] >= 3) {\r\n                this.bannerAds[this.bannerIndex] && this.bannerAds[this.bannerIndex].destroy();\r\n                this.bannerAds[this.bannerIndex] = null;\r\n                this.bannerAds[this.bannerIndex] = this.createBannerAd(this.bannerIndex);\r\n            }\r\n            this.bannerIndex++;\r\n            if (this.bannerIndex >= this.bannerIdArr.length)\r\n                this.bannerIndex = 0;\r\n            this.showBannerAd();\r\n        }\r\n    }\r\n    static stopCountBannerTime() {\r\n        Laya.timer.clear(this, this.countBannerTime);\r\n    }\r\n    static createBannerAd(index, isShow = false) {\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        let sysInfo = this.getSystemInfoSync();\r\n        let bannerAd = Laya.Browser.window['wx'].createBannerAd({\r\n            adUnitId: this.bannerIdArr[index],\r\n            style: {\r\n                top: sysInfo.screenHeight * 0.8,\r\n                width: 300,\r\n                left: sysInfo.screenWidth / 2 - 150\r\n            },\r\n            adIntervals: 30\r\n        });\r\n        bannerAd.onLoad(() => {\r\n            if (isShow) {\r\n                bannerAd.show();\r\n            }\r\n            this.bannerErrorArr[index] = false;\r\n            console.log(\"Banner广告加载成功\");\r\n        });\r\n        bannerAd.onError(err => {\r\n            this.bannerErrorArr[index] = true;\r\n            console.error(\"Banner广告加载失败\", JSON.stringify(err));\r\n        });\r\n        bannerAd.onResize(res => {\r\n            let realHeight = bannerAd.style.realHeight + 0.1;\r\n            bannerAd.style.top = sysInfo.screenHeight - realHeight;\r\n        });\r\n        return bannerAd;\r\n    }\r\n    static createVideoAd() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            var self = this;\r\n            var videoAd = this.videoAd;\r\n            if (videoAd != null) {\r\n                videoAd.offLoad(onLoadVideo);\r\n                videoAd.offError(onErrorVideo);\r\n                videoAd.offClose(onCloseVideo);\r\n            }\r\n            var videoAd = Laya.Browser.window['wx'].createRewardedVideoAd({ adUnitId: self.videoId });\r\n            videoAd.onLoad(onLoadVideo);\r\n            videoAd.onError(onErrorVideo);\r\n            videoAd.onClose(onCloseVideo);\r\n            this.videoAd = videoAd;\r\n        }\r\n        function onLoadVideo() {\r\n            console.log('video 加载成功');\r\n            self.isExistVideoAd = true;\r\n        }\r\n        function onErrorVideo(err) {\r\n            console.error('video 加载错误', err);\r\n            self.isExistVideoAd = false;\r\n        }\r\n        function onCloseVideo(res) {\r\n            let isEnded = (res && res.isEnded || res === undefined) ? true : false;\r\n            if (isEnded) {\r\n                self.videoFinishCallback && self.videoFinishCallback();\r\n                self.videoFinishCallback = null;\r\n            }\r\n            self.videoCancelCallback && self.videoCancelCallback();\r\n            self.videoCancelCallback = null;\r\n        }\r\n    }\r\n    static showVideoAd(finishCB, cancelCB) {\r\n        if (!Laya.Browser.onWeiXin) {\r\n            finishCB && finishCB();\r\n            cancelCB && cancelCB();\r\n            return;\r\n        }\r\n        if (!Laya.Browser.onWeiXin)\r\n            return;\r\n        let self = this;\r\n        this.videoFinishCallback = finishCB;\r\n        this.videoCancelCallback = cancelCB;\r\n        if (!this.isExistVideoAd) {\r\n            this.createVideoAd();\r\n        }\r\n        if (Laya.Browser.onWeiXin) {\r\n            var videoAd = this.videoAd;\r\n            videoAd.show().then(() => { }).catch(err => {\r\n                videoAd.load().then(() => videoAd.show()).catch(err => {\r\n                    self.videoCancelCallback && self.videoCancelCallback();\r\n                    self.videoCancelCallback = null;\r\n                });\r\n            });\r\n        }\r\n    }\r\n    static destroyVideoAd() {\r\n        if (!this.videoAd)\r\n            return;\r\n        this.videoAd.destroy();\r\n        this.videoAd = null;\r\n    }\r\n    static initGridAD() {\r\n        if (!Laya.Browser.onWeiXin) {\r\n            return;\r\n        }\r\n        this.createFullGrid();\r\n        this.createBottomGrid();\r\n        this.createSideGrid();\r\n    }\r\n    static createFullGrid() {\r\n        this.fullGridAd = Laya.Browser.window['wx'].createCustomAd({\r\n            adUnitId: this.fullGridId,\r\n            adIntervals: 30,\r\n            style: {\r\n                left: 0,\r\n                top: this.getSystemInfoSync().screenHeight / 2 - this.getSystemInfoSync().screenWidth / 2 - 50,\r\n                width: this.getSystemInfoSync().screenWidth\r\n            }\r\n        });\r\n        this.fullGridAd.onError(() => { this.fullGridError = true; console.log('全屏格子加载失败'); });\r\n    }\r\n    static visibleFullGridAd(v = true) {\r\n        if (Laya.Browser.onWeiXin && this.fullGridAd && !this.fullGridError) {\r\n            v ? this.fullGridAd.show() : this.fullGridAd.hide();\r\n        }\r\n    }\r\n    static createBottomGrid() {\r\n        this.bottomGridAd = Laya.Browser.window['wx'].createCustomAd({\r\n            adUnitId: this.bottomGridId,\r\n            adIntervals: 30,\r\n            style: {\r\n                left: 47,\r\n                top: this.getSystemInfoSync().screenHeight - 110,\r\n                width: this.getSystemInfoSync().screenWidth\r\n            }\r\n        });\r\n        this.bottomGridAd.onError(() => { this.bottomGridError = true; console.log('底部格子加载失败'); });\r\n    }\r\n    static visibleBottomGridAd(v = true) {\r\n        if (Laya.Browser.onWeiXin && this.bottomGridAd && !this.bottomGridError) {\r\n            v ? this.bottomGridAd.show() : this.bottomGridAd.hide();\r\n        }\r\n    }\r\n    static createSideGrid() {\r\n        for (let i = 0; i < 2; i++) {\r\n            let grid = Laya.Browser.window['wx'].createCustomAd({\r\n                adUnitId: this.sideGridId,\r\n                adIntervals: 30,\r\n                style: {\r\n                    left: i == 0 ? 0 : this.getSystemInfoSync().screenWidth - 65,\r\n                    top: 200\r\n                }\r\n            });\r\n            grid.onError(() => { ; console.log('屏幕侧格子加载失败'); });\r\n            grid.onLoad(() => { this.sideGridAd.push(grid); });\r\n        }\r\n    }\r\n    static visibleSideGridAd(v = true) {\r\n        if (Laya.Browser.onWeiXin && this.sideGridAd.length > 0) {\r\n            for (let i = 0; i < this.sideGridAd.length; i++) {\r\n                v ? this.sideGridAd[i].show() : this.sideGridAd[i].hide();\r\n            }\r\n        }\r\n    }\r\n}\r\nFdAd.bannerIdArr = [\"adunit-16a35519f35328f0\", \"adunit-5537ccffe5089e5c\"];\r\nFdAd.videoId = \"adunit-52288ae43a30597b\";\r\nFdAd.fullGridId = \"adunit-2707a8c0d38ab44f\";\r\nFdAd.bottomGridId = \"adunit-dce12284d42d3f3f\";\r\nFdAd.sideGridId = \"adunit-b0cb6b50398cc60c\";\r\nFdAd.bannerAds = [];\r\nFdAd.bannerIndex = 0;\r\nFdAd.bannerTimesArr = [];\r\nFdAd.bannerShowCount = [];\r\nFdAd.bannerErrorArr = [];\r\nFdAd.isExistVideoAd = false;\r\nFdAd.fullGridAd = null;\r\nFdAd.fullGridError = false;\r\nFdAd.bottomGridAd = null;\r\nFdAd.bottomGridError = false;\r\nFdAd.sideGridAd = [];\r\n",
  "references": [
    "E:/FDProjects/Projects/Mosquito-wzdzz/src/Mod/Utility.ts",
    "E:/FDProjects/Projects/Mosquito-wzdzz/src/FanDong/FdMgr.ts"
  ]
}
