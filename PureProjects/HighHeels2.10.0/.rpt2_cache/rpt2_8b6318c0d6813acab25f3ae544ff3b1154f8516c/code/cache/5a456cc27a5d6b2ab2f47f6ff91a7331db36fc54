{
  "code": "import WxApi from \"../Libs/WxApi\";\r\nimport ShareMgr from \"./ShareMgr\";\r\nimport JJMgr, { SceneDir } from \"../JJExport/Common/JJMgr\";\r\nimport WxPlatformBannerAd from \"./WxPlatformBannerAd\";\r\nexport default class AdMgr {\r\n    constructor() {\r\n        this.bannerUnitId = ['adunit-8c35d63a5ef73657', 'adunit-7ca1534ca1950b65'];\r\n        this.videoUnitId = 'adunit-f760dfb8fcc8c3b9';\r\n        this.bannerAd = null;\r\n        this.videoAd = null;\r\n        this.videoCallback = null;\r\n        this.adCloseCallback = null;\r\n        this.curBannerId = 0;\r\n        this.showBannerCount = 0;\r\n        this.videoIsError = true;\r\n        this.videoLoaded = false;\r\n        this.isBannerError = true;\r\n        this.hadShowBanner = false;\r\n    }\r\n    static get instance() {\r\n        if (!this._instance) {\r\n            this._instance = new AdMgr();\r\n        }\r\n        return this._instance;\r\n    }\r\n    initAd() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            this.initVideo();\r\n        }\r\n    }\r\n    initBanner() {\r\n        this.isBannerError = false;\r\n        let isIphonex = false;\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.getSystemInfo({\r\n                success: res => {\r\n                    let modelmes = res.model;\r\n                    if (modelmes.search('iPhone X') != -1) {\r\n                        isIphonex = true;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        let winSize = Laya.Browser.window.wx.getSystemInfoSync();\r\n        this.bannerAd = Laya.Browser.window.wx.createBannerAd({\r\n            adUnitId: this.bannerUnitId[this.curBannerId],\r\n            style: {\r\n                left: 0,\r\n                top: 0,\r\n                width: 0,\r\n                height: 300\r\n            }\r\n        });\r\n        this.bannerAd.onResize(res => {\r\n            if (isIphonex) {\r\n                this.bannerAd.style.top = winSize.windowHeight - this.bannerAd.style.realHeight - 10;\r\n            }\r\n            else {\r\n                this.bannerAd.style.top = winSize.windowHeight - this.bannerAd.style.realHeight;\r\n            }\r\n            this.bannerAd.style.left = winSize.windowWidth / 2 - this.bannerAd.style.realWidth / 2;\r\n        });\r\n        this.bannerAd.onError(res => {\r\n            this.isBannerError = true;\r\n            console.log('banner error:', JSON.stringify(res));\r\n        });\r\n    }\r\n    hideBanner() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            if (WxPlatformBannerAd.Instance.isLoadBannerError) {\r\n                JJMgr.instance.closeScene(SceneDir.SCENE_SCROLLUI);\r\n            }\r\n            else if (this.hadShowBanner) {\r\n                this.hadShowBanner = false;\r\n                WxPlatformBannerAd.Instance.hideBanner();\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            JJMgr.instance.closeScene(SceneDir.SCENE_SCROLLUI);\r\n        }\r\n    }\r\n    showBanner(isBig = false) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            this.showBannerCount++;\r\n            if (WxPlatformBannerAd.Instance.isLoadBannerError && !WxApi.isKillBossUI) {\r\n                JJMgr.instance.openScene(SceneDir.SCENE_SCROLLUI);\r\n            }\r\n            else {\r\n                this.hadShowBanner = true;\r\n                WxPlatformBannerAd.Instance.showBanner();\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            JJMgr.instance.openScene(SceneDir.SCENE_SCROLLUI);\r\n        }\r\n    }\r\n    destroyBanner() {\r\n        if (Laya.Browser.onWeiXin && this.bannerAd) {\r\n            this.bannerAd.destroy();\r\n            this.bannerAd = null;\r\n        }\r\n    }\r\n    initVideo() {\r\n        if (!Laya.Browser.onWeiXin) {\r\n            return;\r\n        }\r\n        if (!this.videoAd) {\r\n            this.videoAd = Laya.Browser.window.wx.createRewardedVideoAd({\r\n                adUnitId: this.videoUnitId\r\n            });\r\n        }\r\n        this.loadVideo();\r\n        this.videoAd.onLoad(() => {\r\n            console.log('激励视频加载成功');\r\n            this.videoLoaded = true;\r\n        });\r\n        this.videoAd.onError(res => {\r\n            console.log('video Error:', JSON.stringify(res));\r\n            this.videoIsError = true;\r\n        });\r\n    }\r\n    loadVideo() {\r\n        if (Laya.Browser.onWeiXin && this.videoAd != null) {\r\n            this.videoIsError = false;\r\n            this.videoAd.load();\r\n        }\r\n    }\r\n    showVideo(cb) {\r\n        this.videoCallback = cb;\r\n        if (!Laya.Browser.onWeiXin) {\r\n            this.videoCallback();\r\n            this.adCloseCallback && this.adCloseCallback();\r\n            this.adCloseCallback = null;\r\n            return;\r\n        }\r\n        if (this.videoIsError) {\r\n            ShareMgr.instance.shareGame(cb);\r\n            this.loadVideo();\r\n            return;\r\n        }\r\n        if (this.videoLoaded == false) {\r\n            WxApi.OpenAlert('视频正在加载中！');\r\n            return;\r\n        }\r\n        if (this.videoAd) {\r\n            this.videoAd.offClose();\r\n        }\r\n        Laya.SoundManager.muted = true;\r\n        this.videoAd.onClose(res => {\r\n            let isEnded = false;\r\n            if (res && res.isEnded || res === undefined) {\r\n                console.log('正常播放结束，可以下发游戏奖励');\r\n                this.videoCallback();\r\n                isEnded = true;\r\n            }\r\n            else {\r\n                console.log('播放中途退出，不下发游戏奖励');\r\n            }\r\n            this.adCloseCallback && this.adCloseCallback();\r\n            this.adCloseCallback = null;\r\n            Laya.SoundManager.muted = false;\r\n            this.videoLoaded = false;\r\n            this.loadVideo();\r\n            Laya.Browser.window['wx'].JJSendVideoAdCount(() => {\r\n                return {\r\n                    adUnitId: this.videoUnitId,\r\n                    adUnitName: '激励视频名称',\r\n                    isEnded: isEnded\r\n                };\r\n            });\r\n        });\r\n        this.videoAd.show();\r\n    }\r\n}\r\n//# sourceMappingURL=AdMgr.js.map",
  "references": [
    "E:/LayaProjects/PoleRush/src/Mod/Utility.ts",
    "E:/LayaProjects/PoleRush/src/Libs/WxApi.ts",
    "E:/LayaProjects/PoleRush/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/PoleRush/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/PoleRush/src/Mod/WxPlatformBannerAd.ts"
  ],
  "map": "{\"version\":3,\"file\":\"AdMgr.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/Mod/AdMgr.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
