{
  "code": "import Utility from \"../Mod/Utility\";\r\nimport GameLogic from \"./GameLogic\";\r\nexport default class MoveComponent extends Laya.Script3D {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.isRotate = false;\r\n    }\r\n    onAwake() {\r\n        this._self = this.owner;\r\n        this.init();\r\n    }\r\n    init() {\r\n        this.initData();\r\n        this._speedFactor = 1;\r\n        this._maxDis = 0;\r\n        this._maxPosX = 2.4;\r\n        this.stageOff();\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.onMouseUpEvent);\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.onMouseDownEvent);\r\n        Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.onMouseMoveEvent);\r\n    }\r\n    stageOff() {\r\n        Laya.stage.off(Laya.Event.MOUSE_UP, this, this.onMouseUpEvent);\r\n        Laya.stage.off(Laya.Event.MOUSE_DOWN, this, this.onMouseDownEvent);\r\n        Laya.stage.off(Laya.Event.MOUSE_MOVE, this, this.onMouseMoveEvent);\r\n    }\r\n    initData() {\r\n        this._targetPos = new Laya.Vector3;\r\n        this._lerpPos = new Laya.Vector3;\r\n    }\r\n    onMouseDownEvent(evt) {\r\n        if (!GameLogic.Share.isStartGame)\r\n            return;\r\n        Laya.timer.clear(this, this.frameUpdateRolePos);\r\n        Laya.timer.frameLoop(1, this, this.frameUpdateRolePos);\r\n        this.isPressed = true;\r\n        this._originPosX = evt.stageX;\r\n    }\r\n    onMouseUpEvent() {\r\n        if (!GameLogic.Share.isStartGame)\r\n            return;\r\n        this.isPressed = false;\r\n    }\r\n    onMouseMoveEvent(evt) {\r\n        if (!GameLogic.Share.isStartGame || !this._self.transform)\r\n            return;\r\n        if (this.isPressed) {\r\n            let posLimit = this._maxPosX;\r\n            if (evt.stageX != this._originPosX) {\r\n                let pos = this._self.transform.position.clone();\r\n                let rot = this._self.transform.rotationEuler.clone();\r\n                let dis = evt.stageX - this._originPosX;\r\n                if ((dis > 0 && this._maxDis < 0) || (dis < 0 && this._maxDis > 0))\r\n                    this._maxDis = 0;\r\n                if (Math.abs(dis) > Math.abs(this._maxDis)) {\r\n                    this._maxDis = dis;\r\n                }\r\n                pos.x -= 0.01 * this._maxDis * this._speedFactor;\r\n                if (this.isRotate) {\r\n                    let dt = 0.2;\r\n                    if (dis > 0) {\r\n                        let angle = this._self.transform.localRotationEuler.clone();\r\n                        angle.z += dt;\r\n                        Laya.Vector3.lerp(this._self.transform.localRotationEuler.clone(), angle, 0.25, angle);\r\n                        this._self.transform.localRotationEuler = angle;\r\n                        let rPos = Utility.RotateWithPoint(this._self, new Laya.Vector3(0, 0, 1), dt);\r\n                        Laya.Vector3.lerp(this._self.transform.localPosition.clone(), rPos, 0.25, rPos);\r\n                        this._self.transform.localPosition = rPos;\r\n                        GameLogic.Share._playerCrl.randomAngle = 0.25;\r\n                    }\r\n                    else if (dis < 0) {\r\n                        let angle = this._self.transform.localRotationEuler.clone();\r\n                        angle.z -= dt;\r\n                        Laya.Vector3.lerp(this._self.transform.localRotationEuler.clone(), angle, 0.25, angle);\r\n                        this._self.transform.localRotationEuler = angle;\r\n                        let rPos = Utility.RotateWithPoint(this._self, new Laya.Vector3(0, 0, 1), -dt);\r\n                        Laya.Vector3.lerp(this._self.transform.localPosition.clone(), rPos, 0.25, rPos);\r\n                        this._self.transform.localPosition = rPos;\r\n                        GameLogic.Share._playerCrl.randomAngle = -0.25;\r\n                    }\r\n                    this._originPosX = evt.stageX;\r\n                    return;\r\n                }\r\n                if (pos.x > posLimit)\r\n                    pos.x = posLimit;\r\n                else if (pos.x < -posLimit)\r\n                    pos.x = -posLimit;\r\n                this._targetPos = pos;\r\n                this._self.transform.rotationEuler = rot;\r\n                this._originPosX = evt.stageX;\r\n            }\r\n        }\r\n    }\r\n    frameUpdateRolePos() {\r\n        if (this.isRotate)\r\n            return;\r\n        this._targetPos.setValue(this._targetPos.x, this._self.transform.position.y, this._self.transform.position.z);\r\n        Laya.Vector3.lerp(this._self.transform.position, this._targetPos, 0.8, this._lerpPos);\r\n        this._self.transform.position = this._lerpPos;\r\n        if (Math.abs(this._lerpPos.x - this._targetPos.x) < 0.01) {\r\n            this._maxDis = 0;\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Mod/Utility.ts",
    "E:/微信项目集合/工程/HighHeels2.10.0/src/Crl/GameLogic.ts"
  ]
}
